<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âè™ÁªôÂ∞èfrennieÁöÑÊ∏∏Êàè‚òÜ‚òÜ</title>
    <meta name="description" content="‰∏Ä‰∏™ÁâπÂà´‰∏∫Â∞èfrennieÂà∂‰ΩúÁöÑÁà±ÂøÉÊ∏∏Êàè">
    <meta name="theme-color" content="#ff4d94">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        /* Âü∫Á°ÄÊ†∑ÂºèÈáçÁΩÆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Ê†πÂèòÈáèÂÆö‰πâ */
        :root {
            --primary-color: #ff4d94;
            --secondary-color: #ff6b9d;
            --accent-color: #ffd700;
            --text-light: #fff;
            --text-dark: #1a1a1a;
            --bg-gradient: linear-gradient(135deg, #ffb3d9, #ffe6f2);
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.3);
            --shadow-heavy: rgba(0, 0, 0, 0.7);
            --border-radius: 20px;
            --transition: all 0.3s ease;
            --blur-light: blur(1px);
            --blur-medium: blur(5px);
        }

        /* Âü∫Á°ÄÊ†∑Âºè */
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            height: 100vh;
            background: #000;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Âä†ËΩΩÂä®Áîª‰ºòÂåñ */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            will-change: opacity;
        }

        .loading.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-size: clamp(1.2em, 4vw, 1.5em);
            color: var(--primary-color);
            font-weight: bold;
            animation: pulse 1.5s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.6; 
                transform: scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
            }
        }

        /* ÈÄöÁî®sectionÊ†∑Âºè */
        .section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            will-change: opacity;
        }

        .section.active {
            display: block;
            opacity: 1;
        }

        /* ÂºÄÂßãÁïåÈù¢Ê†∑Âºè‰ºòÂåñ */
        #start-section {
            background: var(--bg-gradient);
            position: relative;
            overflow: hidden;
        }

        .wave-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 255, 255, 0.1) 35px, rgba(255, 255, 255, 0.1) 70px);
            animation: waveMove 8s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes waveMove {
            0%, 100% { 
                transform: translateX(0) translateY(0); 
            }
            50% { 
                transform: translateX(10px) translateY(-10px); 
            }
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.3));
            animation: bubbleFloat linear infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            will-change: transform, opacity;
        }

        @keyframes bubbleFloat {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        .start-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }

        .game-title {
            font-size: clamp(2em, 6vw, 3.5em);
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: titleGlow 3s ease-in-out infinite alternate;
            will-change: text-shadow;
        }

        @keyframes titleGlow {
            0% { 
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); 
            }
            100% { 
                text-shadow: 2px 2px 8px rgba(255, 77, 148, 0.3), 0 0 20px rgba(255, 182, 193, 0.5); 
            }
        }

        .star {
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
            animation: starTwinkle 2s ease-in-out infinite alternate;
        }

        @keyframes starTwinkle {
            0% { 
                text-shadow: 0 0 10px var(--accent-color); 
            }
            100% { 
                text-shadow: 0 0 20px var(--accent-color), 0 0 30px var(--accent-color); 
            }
        }

        .start-button {
            padding: 20px 40px;
            font-size: clamp(1.2em, 4vw, 1.5em);
            background: linear-gradient(45deg, var(--secondary-color), #ff8fb3);
            color: var(--text-light);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
            transition: var(--transition);
            font-family: inherit;
            position: relative;
            overflow: hidden;
            font-weight: bold;
        }

        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .start-button:hover::before {
            left: 100%;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.6);
        }

        .start-button:active {
            transform: translateY(-1px);
        }

        /* Ê∏∏ÊàèÈÉ®ÂàÜÊ†∑Âºè‰ºòÂåñ */
        #game-section {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            transition: background-image 0.5s ease-in-out;
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.05);
            backdrop-filter: var(--blur-light);
        }

        .game-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            text-align: center;
        }

        .instruction {
            font-size: clamp(1em, 3vw, 1.2em);
            color: var(--text-light);
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.1);
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 15px var(--shadow-light);
            text-shadow: 1px 1px 2px var(--shadow-heavy);
            backdrop-filter: var(--blur-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .question {
            font-size: clamp(1.2em, 4vw, 2em);
            font-weight: bold;
            color: var(--text-light);
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.1);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 30px var(--shadow-light);
            max-width: 90%;
            width: 100%;
            max-width: 800px;
            line-height: 1.4;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
            backdrop-filter: var(--blur-light);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: questionAppear 0.6s ease-out;
            will-change: transform, opacity;
        }

        @keyframes questionAppear {
            0% { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .answer-buttons {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .answer-btn {
            padding: 15px 30px;
            font-size: clamp(1.1em, 3vw, 1.3em);
            border: 3px solid rgba(52, 152, 219, 0.9);
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px var(--shadow-medium);
            backdrop-filter: var(--blur-medium);
            font-weight: bold;
            font-family: inherit;
            min-width: 120px;
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .answer-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .answer-btn:hover {
            background: rgba(52, 152, 219, 0.8);
            color: var(--text-light);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            border-color: rgba(52, 152, 219, 1);
        }

        .answer-btn:active {
            transform: translateY(0);
        }

        /* ÁªìÂ∞æÈÉ®ÂàÜÊ†∑Âºè‰ºòÂåñ */
        #ending-section {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3));
            position: relative;
            overflow: hidden;
            will-change: transform;
            min-height: 100vh;
        }

        .ending-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.9;
            z-index: 1;
            will-change: opacity;
            transition: opacity 0.5s ease-in-out;
            object-fit: contain;
        }

        .ending-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px 20px;
            will-change: transform;
        }

        .message-container {
            position: relative;
            width: min(90%, 800px);
            height: 80%;
            overflow: hidden;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: var(--blur-light);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            will-change: transform;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scrolling-text {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            color: var(--text-light);
            font-size: clamp(1.2em, 3.5vw, 1.6em);
            line-height: 2.5;
            text-align: center;
            text-shadow: 2px 2px 6px var(--shadow-heavy);
            animation: scrollUp 300s linear;
            white-space: pre-line;
            font-weight: 500;
            padding: 0 20px;
            transition: opacity 1s ease-out;
            will-change: transform;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            user-select: none;
            pointer-events: none;
        }

        @keyframes scrollUp {
            0% {
                transform: translateX(-50%) translateY(120%);
            }
            100% {
                transform: translateX(-50%) translateY(-120%);
            }
        }

        .final-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.5em, 5vw, 2.5em);
            font-weight: bold;
            color: var(--text-light);
            text-shadow: 3px 3px 8px var(--shadow-heavy);
            opacity: 0;
            text-align: center;
            z-index: 20;
            padding: 30px;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: var(--blur-medium);
            will-change: opacity, transform;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
            pointer-events: none;
        }

        .final-message.show {
            opacity: 1;
            animation: fadeIn 3s ease-in-out;
        }

        @keyframes fadeIn {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8) rotateY(-90deg); 
            }
            100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
            }
        }

        .celestial {
            position: absolute;
            color: var(--accent-color);
            font-size: clamp(1.5em, 4vw, 2em);
            animation: twinkle 3s ease-in-out infinite;
            filter: drop-shadow(0 0 15px var(--accent-color));
            text-shadow: 0 0 20px var(--accent-color);
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            pointer-events: none;
            user-select: none;
            z-index: 15;
        }

        @keyframes twinkle {
            0% { 
                opacity: 0.4; 
                transform: scale(0.8) rotate(0deg); 
                filter: drop-shadow(0 0 10px var(--accent-color));
            }
            50% { 
                opacity: 1; 
                transform: scale(1.3) rotate(180deg); 
                filter: drop-shadow(0 0 25px var(--accent-color));
            }
            100% { 
                opacity: 0.4; 
                transform: scale(0.8) rotate(360deg); 
                filter: drop-shadow(0 0 10px var(--accent-color));
            }
        }

        .moon {
            position: absolute;
            top: 10%;
            right: 10%;
            font-size: clamp(2em, 6vw, 4em);
            color: #f0f0f0;
            text-shadow: 0 0 20px #f0f0f0;
            animation: moonGlow 4s ease-in-out infinite alternate;
            will-change: text-shadow;
            pointer-events: none;
            user-select: none;
            z-index: 5;
        }

        @keyframes moonGlow {
            0% { text-shadow: 0 0 20px #f0f0f0; }
            100% { text-shadow: 0 0 40px #f0f0f0, 0 0 60px #f0f0f0; }
        }

        /* Èü≥È¢ëÊéßÂà∂‰ºòÂåñ */
        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            font-size: 1.2em;
            transition: var(--transition);
            backdrop-filter: var(--blur-medium);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .audio-control:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        /* ËøõÂ∫¶ÊåáÁ§∫Âô®‰ºòÂåñ */
        .progress-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .progress-dot.active {
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            transform: scale(1.2);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ°‰ºòÂåñ */
        @media (max-width: 768px) {
            .answer-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .answer-btn {
                width: 200px;
            }
            
            .message-container {
                width: 95%;
            }
            
            .moon {
                top: 5%;
                right: 5%;
            }
        }

        @media (max-width: 480px) {
            .start-content {
                padding: 20px;
            }
            
            .game-content {
                padding: 15px;
            }
            
            .question {
                padding: 20px;
            }
        }

        /* ÊÄßËÉΩ‰ºòÂåñ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ÊâìÂç∞Ê†∑Âºè */
        @media print {
            .section:not(.active) {
                display: none !important;
            }
        }

        /* ÁÑ¶ÁÇπÊ†∑Âºè‰ºòÂåñ */
        .start-button:focus,
        .answer-btn:focus,
        .audio-control:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Âä†ËΩΩ‰ºòÂåñ */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* ÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 768px) {
            .message-container {
                width: 95%;
                height: 85%;
            }
            
            .scrolling-text {
                font-size: clamp(1em, 3vw, 1.4em);
                line-height: 2.2;
            }
            
            .final-message {
                font-size: clamp(1.3em, 4vw, 2.2em);
                padding: 25px;
            }
            
            .moon {
                top: 5%;
                right: 5%;
                font-size: clamp(1.5em, 5vw, 3em);
            }
        }

        @media (max-width: 480px) {
            .ending-content {
                padding: 20px 15px;
            }
            
            .message-container {
                width: 98%;
                height: 90%;
            }
            
            .scrolling-text {
                font-size: clamp(0.9em, 2.8vw, 1.3em);
                line-height: 2.0;
                padding: 0 15px;
            }
            
            .final-message {
                font-size: clamp(1.2em, 3.5vw, 2em);
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Âä†ËΩΩÁïåÈù¢ -->
    <div class="loading" id="loading">
        <div class="loading-text">Ê≠£Âú®‰∏∫Â∞èfrennieÂáÜÂ§áÊ∏∏Êàè...</div>
    </div>

    <!-- ÂºÄÂßãÁïåÈù¢ -->
    <div id="start-section" class="section active">
        <div class="wave-pattern"></div>
        <div class="start-content">
            <h1 class="game-title">Âè™ÁªôÂ∞èfrennieÁöÑÊ∏∏Êàè<span class="star">‚òÜ‚òÜ</span></h1>
            <button class="start-button" onclick="startGame()" aria-label="ÂºÄÂßãÊ∏∏Êàè">ÂºÄÂßãÊ∏∏Êàè</button>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÈÉ®ÂàÜ -->
    <div id="game-section" class="section">
        <div class="game-overlay"></div>
        <div class="game-content">
            <div class="instruction" id="instruction">ÊòØÁöÑËØùÈÄâÊã©"ÂóØ"Ôºå‰∏çÊòØÁöÑËØùÂ∞±Â°´"‰∏çÊòØ"</div>
            <div class="question" id="question-text" role="main"></div>
            <div class="answer-buttons">
                <button class="answer-btn" onclick="nextQuestion()" aria-label="ÊòØÁöÑ">ÂóØ</button>
                <button class="answer-btn" onclick="nextQuestion()" aria-label="‰∏çÊòØÁöÑ">‰∏çÊòØ</button>
            </div>
        </div>
    </div>

    <!-- ÁªìÂ∞æÈÉ®ÂàÜ -->
    <div id="ending-section" class="section">
        <div class="ending-background" id="ending-background"></div>
        <div class="ending-content">
            <div class="message-container">
                <div class="scrolling-text" id="scrolling-text"></div>
            </div>
            <div class="final-message" id="final-message">ÊàëÁà±‰Ω†ÔºåÊàëÁöÑÂ∞èFrennieÔºåÁ•ù‰Ω†Âπ∏Á¶è</div>
            <div class="moon">üåô</div>
        </div>
    </div>

    <!-- Èü≥È¢ëÊéßÂà∂ -->
    <div class="audio-control" id="audio-control" onclick="toggleAudio()" title="Èü≥È¢ëÊéßÂà∂">
        <span id="audio-icon">üîä</span>
    </div>

    <!-- ËøõÂ∫¶ÊåáÁ§∫Âô® -->
    <div class="progress-indicator" id="progress-indicator"></div>

    <!-- Èü≥È¢ëÂÖÉÁ¥† -->
    <audio id="start-audio" loop preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="start-music.mp3" type="audio/mpeg">
        <source src="start-music.ogg" type="audio/ogg">
    </audio>
    <audio id="game-audio" loop preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="game-music.mp3" type="audio/mpeg">
        <source src="game-music.ogg" type="audio/ogg">
    </audio>
    <audio id="ending-audio" preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="ending-music.mp3" type="audio/mpeg">
        <source src="ending-music.ogg" type="audio/ogg">
    </audio>

    <script>
        // Ê∏∏ÊàèÁä∂ÊÄÅÁÆ°ÁêÜ - ‰ºòÂåñÁâàÊú¨
        class GameState {
            constructor() {
                this.currentQuestion = 0;
                this.audioEnabled = true;
                this.isTransitioning = false;
                this.preloadedImages = new Map();
                this.isInitialized = false;
                this.resourcesLoaded = false;
            }

            reset() {
                this.currentQuestion = 0;
                this.isTransitioning = false;
            }
        }

        const gameState = new GameState();

        // ÈóÆÈ¢òÊï∞ÁªÑ - ‰ºòÂåñÁªìÊûÑ
        const questions = [
            "‰Ω†ÂøÉÈáåËøòÊúâ‰ªñÂêóÔºü",
            "‰∏∫‰ªÄ‰πà‰Ω†ÊòØÂê¶ÁúãÂà∞‰ªñÁöÑÊó∂ÂÄô‰ºöÊÑüÂà∞‰º§ÂøÉÂíåÈöæËøáÔºü",
            "‰Ω†ÊòØ‰∏çÊòØÂÆ≥ÊÄï‰ªñÂú®ÂÅö‰ªª‰Ωï‰º§ÂÆ≥Ëá™Â∑±ÁöÑ‰∫ãÊÉÖÔºü",
            "‰Ω†ÊòØ‰∏çÊòØÂæàËá™Ë¥£Á¶ªÂºÄ‰∫Ü‰ªñËÆ©‰ªñÁóõËã¶‰∫ÜÔºü",
            "‰Ω†‰ºö‰∏ç‰ºöÂÆ≥ÊÄïÂú®ÁúãÂà∞‰ªñÁöÑÊó∂ÂÄô‰ºöÊÉ≥Ëµ∑‰Ω†‰ª¨ÁöÑÂõûÂøÜÁÑ∂ÂêéÂæàÈöæÈù¢ÂØπ‰ªñÔºü",
            "‰∏∫‰ªÄ‰πàÊØèÊ¨°‰ªñÈóÆ‰Ω†‰∫ãÊÉÖÁöÑÊó∂ÂÄôÔºå‰Ω†ÈÉΩ‰ºöÂæàÊéíÊñ•‰ªñÔºåÊòØÂõ†‰∏∫‰ªñ‰º§ÂÆ≥‰∫Ü‰Ω†ÂêóÔºüËÆ©‰Ω†‰º§ÂøÉÈöæËøáÂßîÂ±à‰∫ÜÂêóÔºü‰Ω†Êé•Âèó‰∏ç‰∫ÜÂêóÔºüËøòÊòØËØ¥‰ªñÂº∫Ëø´‰∫Ü‰Ω†ÔºåÁªô‰∫à‰∫Ü‰Ω†ÂæàÂ§ßÁöÑÂéãÂäõÂë¢Ôºü",
            "‰Ω†ÊúâÊ≤°ÊúâÂéüË∞Ö‰ªñÁªô‰Ω†Â∏¶Êù•ÁöÑ‰º§ÂÆ≥ÔºåÊúâÊ≤°ÊúâÁêÜËß£‰ªñÊ≤°ÊúâÂÅöÂà∞ÁöÑÁêÜÁî±Ôºü",
            "ÂÅáÂ¶ÇËØ¥‰Ω†ËÉΩÂ§üÁêÜËß£ÁöÑËØù‰ªñ‰πüÂ•ΩËµ∑Êù•‰∫ÜÔºå‰Ω†ËøòÊÑø‰∏çÊÑøÊÑèË∑ü‰ªñÂÜçÈáçÊñ∞Êù•Ëøá‰∏ÄÊ¨°Ôºü",
            "Â¶ÇÊûúËøôÊ†∑ÂÅö‰Ω†‰ºö‰∏ç‰ºöÊÑüËßâÂà∞ÂæàÁóõËã¶Ôºü",
            "‰ªñÊâÄÂÅöÁöÑÂä™ÂäõÔºåÂÖ∂ÂÆû‰Ω†ÊúâÊ≤°ÊúâÁúãÂú®ÁúºÈáåÔºåÊúâÊ≤°ÊúâÊÑüÂä®Âà∞Ôºü",
            "‰Ω†ÊúâÊ≤°ÊúâËßâÂæó‰Ω†ÊòØ‰∏™Â∞èÂÇªÁìúÔºåÂõ†‰∏∫‰ªñÊòéÊòéÈÇ£‰πàÁöÑÁà±‰Ω†Ôºå‰ΩÜÊòØ‰Ω†Ê≤°ÊúâÊÑüËßâÂà∞ÔºåÁÑ∂ÂêéË¶ÅÁ¶ªÂºÄ‰ªñ‰∫ÜÔºåÊîæÂºÉ‰∫Ü‰∏Ä‰∏™‰Ω†ÂñúÊ¨¢‰ªñÔºå‰ªñ‰πüÂñúÊ¨¢‰Ω†ÁöÑ‰∫∫Ôºü",
            "‰Ω†‰ºöÊîæ‰∏ãËøôÊÆµÊÑüÊÉÖÂêóÔºåÂì™ÊÄïÈîôËøá‰∫ÜÂ∞±ÂÜç‰πüÊ≤°Êú∫‰ºöÈÅáÂà∞‰∫ÜÔºåËøôÊ†∑ÁöÑÊîæ‰∏ã‰ºöËÆ©‰Ω†ÈÅóÊÜæ‰∏ÄËæàÂ≠êÂêóÔºü"
        ];

        // ËÉåÊôØÂõæÁâáÊï∞ÁªÑ
        const backgroundImages = [
            'your-photo1.jpg',
            'your-photo2.jpg',
            'your-photo3.jpg',
            'your-photo4.jpg',
            'your-photo5.jpg',
            'your-photo6.jpg',
            'your-photo7.jpg',
            'your-photo8.jpg',
            'your-photo9.jpg',
            'your-photo10.jpg',
            'your-photo11.jpg',
            'your-photo12.jpg'
        ];

        // Èü≥È¢ëÂºïÁî®
        let startAudio, gameAudio, endingAudio;

        // Â∑•ÂÖ∑ÂáΩÊï∞ - ‰ºòÂåñÁâàÊú¨
        const utils = {
            // Èò≤ÊäñÂáΩÊï∞‰ºòÂåñ
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // ËäÇÊµÅÂáΩÊï∞
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },

            // È¢ÑÂä†ËΩΩÂõæÁâá‰ºòÂåñ
            preloadImage(src) {
                return new Promise((resolve, reject) => {
                    if (gameState.preloadedImages.has(src)) {
                        resolve(gameState.preloadedImages.get(src));
                        return;
                    }
                    
                    const img = new Image();
                    img.onload = () => {
                        gameState.preloadedImages.set(src, img);
                        resolve(img);
                    };
                    img.onerror = reject;
                    img.src = src;
                });
            },

            // ÊâπÈáèÈ¢ÑÂä†ËΩΩÂõæÁâá‰ºòÂåñ
            async preloadImages(srcs) {
                const promises = srcs.map(src => this.preloadImage(src).catch(() => null));
                return Promise.allSettled(promises);
            },

            // Âπ≥ÊªëÂàáÊç¢section‰ºòÂåñ
            switchSection(fromId, toId) {
                if (gameState.isTransitioning) return;
                gameState.isTransitioning = true;

                const fromSection = document.getElementById(fromId);
                const toSection = document.getElementById(toId);

                if (!fromSection || !toSection) {
                    console.error('Section not found');
                    gameState.isTransitioning = false;
                    return;
                }

                // Ê∑°Âá∫ÂΩìÂâçsection
                fromSection.style.opacity = '0';
                
                setTimeout(() => {
                    fromSection.classList.remove('active');
                    toSection.classList.add('active');
                    
                    // Ê∑°ÂÖ•Êñ∞section
                    requestAnimationFrame(() => {
                        toSection.style.opacity = '1';
                        gameState.isTransitioning = false;
                    });
                }, 300);
            },

            // ÈîôËØØÂ§ÑÁêÜ
            handleError(error, context) {
                console.error(`Error in ${context}:`, error);
                // ÂèØ‰ª•Ê∑ªÂä†Áî®Êà∑ÂèãÂ•ΩÁöÑÈîôËØØÊèêÁ§∫
            }
        };

        // Èü≥È¢ëÁÆ°ÁêÜ - ‰ºòÂåñÁâàÊú¨
        const audioManager = {
            init() {
                startAudio = document.getElementById('start-audio');
                gameAudio = document.getElementById('game-audio');
                endingAudio = document.getElementById('ending-audio');

                // È¢ÑÂä†ËΩΩÈü≥È¢ëÂπ∂ËÆæÁΩÆÁßªÂä®Á´Ø‰ºòÂåñ
                [startAudio, gameAudio, endingAudio].forEach(audio => {
                    if (audio) {
                        // ÁßªÂä®Á´Ø‰ºòÂåñËÆæÁΩÆ
                        audio.preload = 'auto';
                        audio.load();
                        audio.volume = 0.7;
                        
                        // ËÆæÁΩÆÁßªÂä®Á´ØÂÖºÂÆπÊÄß
                        audio.setAttribute('playsinline', '');
                        audio.setAttribute('webkit-playsinline', '');
                        audio.setAttribute('x5-playsinline', '');
                        
                        // ÈîôËØØÂ§ÑÁêÜ
                        audio.addEventListener('error', (e) => {
                            utils.handleError(e, 'Audio loading');
                        });
                        
                        // ÁßªÂä®Á´ØÁâπÊÆäÂ§ÑÁêÜ
                        audio.addEventListener('canplay', () => {
                            console.log('Èü≥È¢ëÂèØ‰ª•Êí≠Êîæ');
                        });
                        
                        audio.addEventListener('canplaythrough', () => {
                            console.log('Èü≥È¢ëÂÆåÂÖ®Âä†ËΩΩ');
                        });
                    }
                });
            },

            async play(audio) {
                if (!gameState.audioEnabled || !audio) return;
                
                try {
                    // Á°Æ‰øùÈü≥È¢ëÂ∑≤Âä†ËΩΩ
                    if (audio.readyState < 2) {
                        await new Promise((resolve) => {
                            audio.addEventListener('canplaythrough', resolve, { once: true });
                            audio.load();
                        });
                    }
                    
                    // ÁßªÂä®Á´ØÁâπÊÆäÂ§ÑÁêÜ
                    audio.currentTime = 0;
                    
                    // Â∞ùËØïÂ§öÁßçÊí≠ÊîæÊñπÂºè
                    try {
                        await audio.play();
                    } catch (e) {
                        // Â¶ÇÊûúÁõ¥Êé•Êí≠ÊîæÂ§±Ë¥•ÔºåÂ∞ùËØïÈùôÈü≥Êí≠ÊîæÂêéÂèñÊ∂àÈùôÈü≥
                        audio.muted = true;
                        await audio.play();
                        audio.muted = false;
                        audio.volume = 0.7;
                    }
                } catch (e) {
                    utils.handleError(e, 'Audio playback');
                    console.warn('Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•ÔºåÈúÄË¶ÅÁî®Êà∑‰∫§‰∫í');
                }
            },

            stop(audio) {
                if (!audio) return;
                audio.pause();
                audio.currentTime = 0;
            },

            toggle() {
                gameState.audioEnabled = !gameState.audioEnabled;
                const icon = document.getElementById('audio-icon');
                
                if (gameState.audioEnabled) {
                    icon.textContent = 'üîä';
                    this.resumeCurrentAudio();
                } else {
                    icon.textContent = 'üîá';
                    [startAudio, gameAudio, endingAudio].forEach(audio => {
                        if (audio) audio.pause();
                    });
                }
            },

            resumeCurrentAudio() {
                const startSection = document.getElementById('start-section');
                const gameSection = document.getElementById('game-section');
                const endingSection = document.getElementById('ending-section');

                if (startSection.classList.contains('active')) {
                    this.play(startAudio);
                } else if (gameSection.classList.contains('active')) {
                    this.play(gameAudio);
                } else if (endingSection.classList.contains('active')) {
                    this.play(endingAudio);
                }
            }
        };

        // ËøõÂ∫¶ÊåáÁ§∫Âô® - ‰ºòÂåñÁâàÊú¨
        const progressIndicator = {
            init() {
                const container = document.getElementById('progress-indicator');
                if (!container) return;
                
                container.innerHTML = '';
                
                // ÂàõÂª∫ËøõÂ∫¶ÁÇπÔºöÂºÄÂßã + 12‰∏™ÈóÆÈ¢ò + ÁªìÂ∞æ = 14‰∏™ÁÇπ
                for (let i = 0; i < 14; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'progress-dot';
                    if (i === 0) dot.classList.add('active');
                    container.appendChild(dot);
                }
            },

            update(step) {
                const dots = document.querySelectorAll('.progress-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index <= step);
                });
            }
        };

        // Ê≥°Ê≥°ÊïàÊûúÁÆ°ÁêÜ - ‰ºòÂåñÁâàÊú¨
        const bubbleManager = {
            intervalId: null,
            
            start() {
                const container = document.getElementById('start-section');
                if (!container) return;
                
                this.intervalId = setInterval(() => {
                    if (!document.getElementById('start-section').classList.contains('active')) {
                        return;
                    }
                    
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = Math.random() * 100 + '%';
                    bubble.style.width = bubble.style.height = (Math.random() * 60 + 20) + 'px';
                    bubble.style.animationDuration = (Math.random() * 3 + 4) + 's';
                    container.appendChild(bubble);

                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 7000);
                }, 500);
            },

            stop() {
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
            }
        };

        // Ê∏∏ÊàèÊ†∏ÂøÉÂäüËÉΩ - ‰ºòÂåñÁâàÊú¨
        const gameCore = {
            async startGame() {
                if (gameState.isTransitioning) return;
                
                bubbleManager.stop();
                audioManager.stop(startAudio);
                
                utils.switchSection('start-section', 'game-section');
                
                await audioManager.play(gameAudio);
                this.showQuestion();
                progressIndicator.update(1);
            },

            async showQuestion() {
                if (gameState.currentQuestion >= questions.length) {
                    this.showEnding();
                    return;
                }

                const questionElement = document.getElementById('question-text');
                const instructionElement = document.getElementById('instruction');
                
                if (!questionElement || !instructionElement) {
                    utils.handleError('Question elements not found', 'showQuestion');
                    return;
                }
                
                // Âè™Âú®Á¨¨‰∏ÄÈ¢òÊòæÁ§∫ËØ¥Êòé
                if (gameState.currentQuestion === 0) {
                    instructionElement.style.display = 'block';
                } else {
                    instructionElement.style.display = 'none';
                }

                questionElement.style.opacity = '0';
                
                // È¢ÑÂä†ËΩΩÂπ∂ËÆæÁΩÆËÉåÊôØ
                const imageSrc = backgroundImages[gameState.currentQuestion];
                try {
                    await utils.preloadImage(imageSrc);
                    const gameSection = document.getElementById('game-section');
                    if (gameSection) {
                        gameSection.style.backgroundImage = `url("${imageSrc}")`;
                    }
                } catch (e) {
                    utils.handleError(e, 'Background image loading');
                }
                
                setTimeout(() => {
                    questionElement.textContent = questions[gameState.currentQuestion];
                    questionElement.style.opacity = '1';
                    progressIndicator.update(gameState.currentQuestion + 2);
                }, 300);
            },

            nextQuestion: utils.debounce(function() {
                const questionElement = document.getElementById('question-text');
                if (!questionElement || questionElement.style.opacity === '0' || !questionElement.textContent) {
                    return;
                }
                
                gameState.currentQuestion++;
                if (gameState.currentQuestion < questions.length) {
                    gameCore.showQuestion();
                } else {
                    gameCore.showEnding();
                }
            }, 500),

            async showEnding() {
                try {
                    // ÂÅúÊ≠¢Ê∏∏ÊàèÈü≥È¢ë
                    audioManager.stop(gameAudio);
                    
                    // È¢ÑÂä†ËΩΩÂπ∂ËÆæÁΩÆÊÉÖ‰æ£ÁÖßÁâáËÉåÊôØ
                    const endingBg = document.getElementById('ending-background');
                    if (endingBg) {
                        try {
                            await utils.preloadImage('couple-photo.jpg');
                            endingBg.style.backgroundImage = 'url("couple-photo.jpg")';
                        } catch (e) {
                            utils.handleError(e, 'Couple photo loading');
                        }
                    }
                    
                    // ÂàáÊç¢Âà∞ÁªìÂ∞æÈÉ®ÂàÜ
                    utils.switchSection('game-section', 'ending-section');
                    
                    // Êí≠ÊîæÁªìÂ∞æÈü≥‰πêÂπ∂Á´ãÂç≥ÂºÄÂßãÂ≠óÂπï
                    await audioManager.play(endingAudio);
                    this.startScrollingText();
                    
                    // Êõ¥Êñ∞ËøõÂ∫¶ÊåáÁ§∫Âô®
                    progressIndicator.update(13);
                } catch (error) {
                    utils.handleError(error, 'showEnding');
                }
            },

            startScrollingText() {
                // Â≠óÂπïÂÜÖÂÆπ
                const message = `ÂÖ∂ÂÆûÁ≠îÊ°àÂπ∂‰∏çÈáçË¶ÅÔºåÂ∞èÂÇªÁìú
Âà´ÂÜçÈíªÁâõËßíÂ∞ñÂï¶
‰πüÂà´ÂÜçÊÉ≥Âà∞ÊàëÂ∞±ÁóõËã¶‰∫ÜÂô¢

Êàë‰ª¨ÊòéÊòéËøáÂæóÈÇ£‰πàÂºÄÂøÉ
‰Ω†ÊÉ≥ÊÉ≥ÂëÄÂéªÂπ¥ÊàëÈÇ£‰πàÂú∞ÁÖßÈ°æ‰Ω†
ÈÇ£‰πàÂú∞Âú®‰πé‰Ω†ÊâÄËØ¥ÁöÑ‰∫ãÊÉÖ

Âì™Êúâ‰∏Ä‰∏™‰∏çÁà±‰Ω†ÁöÑÁî∑Áîü
‰ºöÊó∂Êó∂ÂàªÂàªËÆ∞Âæó
ÊâÄÊúâ‰Ω†ÁöÑ‰∫ãÊÉÖÂë¢

ÊàëÁü•ÈÅìÂÖ∂ÂÆûÊúâÁöÑÊó∂ÂÄô
‰Ω†ÂÜÖÂøÉÊòØÂú®Â¥©Â°åËæπÁºòÁöÑ
ÊÄªÊòØ‰∏Ä‰∏™‰∫∫ÈªòÈªòÊâøÂèó

ËôΩÁÑ∂Ë°®Èù¢‰∏äË£ÖÂæóÂæàÂùöÂº∫
‰∏çËøáÈÉΩÊòØ‰∏∫‰∫ÜËÆ©Êàë‰ª¨ËßâÂæó
‰∏çË¶ÅÊãÖÂøÉ‰Ω†ÔºåËßâÂæó‰Ω†Ê≤°Êúâ‰∫ãÊÉÖ

ÊâÄ‰ª•ÊàëÊâç‰ºöÊ≤°ÂèëÁé∞Âà∞
‰Ω†ÊÄªÊòØ‰∏Ä‰∏™‰∫∫Âì≠Ê≥£
ÊòØÊàë‰∏çÁªÜÂøÉ‰∫ÜÔºÅ

‰Ω†Âè™‰∏çËøáÊòØ‰∏™ÂæàË¶ÅÂº∫ÁöÑÂ∞èÂ•≥Áîü
ÂÖ∂ÂÆûÂÜÖÂøÉÂæàËÑÜÂº±‰πüÂæàËÉÜÂ∞è
ÊúâÊó∂ÂÄôÊÄªËßâÂæóËá™Â∑±ÂæàÊó†Âä©

ÂØπÂæàÂ§ö‰∫ãÊÉÖÈÉΩÊó†ËÉΩ‰∏∫Âäõ
Âç≥‰æø‰Ω†‰ªÄ‰πàÈÉΩÊ≤°ËØ¥
Âç¥ÂèàÂ∏åÊúõÊúâ‰∫∫Áü•ÈÅì‰Ω†ÂÜÖÂøÉÁöÑÁªùÊúõÊÑü

ÈÇ£‰∏™‰∫ÜËß£‰Ω†ÁöÑ‰∫∫‰ºöÊãâ‰Ω†‰∏ÄÊää
Âì™ÊÄïÂè™ÊòØ‰∏ÄÊ¨°
‰πüËÉΩÊãØÊïë‰Ω†ÁöÑÂøÉ

ÊàëÊÉ≥‰Ω†‰ºöÂñúÊ¨¢‰∏äÊàë
ËÇØÂÆöÊòØÂõ†‰∏∫‰Ω†Ê≤°ÊÉ≥Ëøá
‰ºöÊúâ‰∫∫Áî®Ê∏©ÊüîÊé•‰Ωè‰∫Ü‰Ω†Âø´Â¥©Â°åÁöÑ‰∏ñÁïå

‰Ω†‰πüËØ¥ËøáÊàëÂ∞±Â•ΩÂÉèÊòüËæ∞
ÊàëÂæàËç£Âπ∏‰Ω†ËÉΩÈÇ£‰πà‰ø°‰ªªÊàë
ÊâÄ‰ª•ÊàëÊâç‰ºöÂú®‰Ω†ÊúâÂõ∞ÈöæÁöÑÊó∂ÂÄô

Êó†Êù°‰ª∂ÁöÑÁªô‰Ω†‰∏ÄÁõèÁÅØ
‰πüÂÉèÊòüËæ∞‰∏ÄÊ†∑
ÊåáÂºïÁùÄ‰Ω†

ÊàëÂëÄÔºåÊó©Âú®Êàë‰ª¨‰ΩèÂú®‰∏ÄËµ∑ÁöÑÊó∂ÂÄô
Â∞±Âä™ÂäõÁöÑËÄêÂøÉÁöÑÂÆàÂÄôÁùÄ
ÈÇ£‰∏™ÈùûÂ∏∏‰∏çÂÆåÁæéÁöÑ‰Ω†

Âõ†‰∏∫ÈÇ£‰∏™‰∫∫ÊòØ‰Ω†
ÊâÄ‰ª•‰Ω†ÁöÑÊÄßÊ†º
‰Ω†ÁöÑÊØè‰∏™‰π†ÊÉØÊàëÈÉΩ‰ºöÂæàÂñúÊ¨¢ÁùÄ

ÂÖ∂ÂÆûÂêàÈÄÇÁöÑ‰∫∫
ÈÉΩ‰ºöÁªèÂéÜÁôæÊ¨°ÁöÑ‰∏çÂêàÈÄÇ
Ê≤°ÊúâÂ§©ÁîüÂ∞±ÂêàÈÄÇÁöÑ‰∏§‰∏™‰∫∫

Âè™Êúâ‰∏§‰∏™ÊÑøÊÑèÁ£®ÂêàÁöÑÂøÉ
ÂØπÊàëÊù•ËØ¥
ÊàëÁà±‰∏ä‰Ω†Ê≤°‰ªÄ‰πà‰∫Ü‰∏çËµ∑

‰ΩÜÊàë‰ºöÁà±‰∏ãÂéª
Êâç‰∫Ü‰∏çËµ∑

Â¶Ç‰ªäÁöÑÊàë‰∏çÂÜçÈªëÊöóÈáåÊ≤âÊ≤¶
‰πüÊâæÂà∞Ëá™Â∑±ÁöÑÁõÆÊ†á‰∫Ü
Áé∞Âú®ÁöÑ‰Ω†

Â¶ÇÊûúÊâæÂà∞‰∫Ü‰Ω†ÊÉ≥Ë¶ÅÁöÑ‰∫∫ÂíåÊñπÂêë
Â∞±ÂæÄÈÇ£‰∏™ÊñπÂêëÂ•îË∑ëÂêß
ÊàëÁ•ùÁ¶è‰Ω†

ÊÑø‰Ω†Ëøô‰∏ÄÁîü
ÈÉΩËÉΩÂø´Âø´‰πê‰πê`;

                const scrollingText = document.getElementById('scrolling-text');
                if (!scrollingText) {
                    utils.handleError('Scrolling text element not found', 'startScrollingText');
                    return;
                }

                // ËÆæÁΩÆÊñáÂ≠óÂÜÖÂÆπÂπ∂Á´ãÂç≥ÂºÄÂßãÊªöÂä®
                scrollingText.textContent = message;
                
                // 165ÁßíÂêéÊòæÁ§∫ÊúÄÁªàÊ∂àÊÅØÂíåÊòüÊòüÁâπÊïà
                setTimeout(() => {
                    this.showFinalMessage();
                }, 165000);
            },

            showFinalMessage() {
                try {
                    const finalMessage = document.getElementById('final-message');
                    if (finalMessage) {
                        finalMessage.classList.add('show');
                    }
                    this.createStars();
                } catch (error) {
                    utils.handleError(error, 'showFinalMessage');
                }
            },

            createStars() {
                const container = document.getElementById('ending-section');
                if (!container) {
                    utils.handleError('Ending section not found', 'createStars');
                    return;
                }
                
                const starCount = 12;
                const stars = [];
                
                // ÂàõÂª∫ÊòüÊòü
                for (let i = 0; i < starCount; i++) {
                    setTimeout(() => {
                        const star = document.createElement('div');
                        star.className = 'celestial';
                        star.innerHTML = '‚≠ê';
                        
                        // ÈöèÊú∫‰ΩçÁΩÆÔºåÈÅøÂÖçÈáçÂè†
                        let top, left;
                        do {
                            top = Math.random() * 80 + 10;
                            left = Math.random() * 80 + 10;
                        } while (this.isPositionTooClose(top, left, stars));
                        
                        star.style.top = top + '%';
                        star.style.left = left + '%';
                        star.style.animationDelay = Math.random() * 3 + 's';
                        star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                        
                        container.appendChild(star);
                        stars.push(star);
                        
                        // 5ÁßíÂêéÁßªÂä®Âà∞Êñ∞‰ΩçÁΩÆ
                        setTimeout(() => {
                            this.moveStarToNewPosition(star, container);
                        }, 5000 + Math.random() * 3000);
                    }, i * 300);
                }
            },
            
            isPositionTooClose(top, left, existingStars) {
                for (let star of existingStars) {
                    const starTop = parseFloat(star.style.top);
                    const starLeft = parseFloat(star.style.left);
                    const distance = Math.sqrt(Math.pow(top - starTop, 2) + Math.pow(left - starLeft, 2));
                    if (distance < 15) return true;
                }
                return false;
            },
            
            moveStarToNewPosition(star, container) {
                if (!star || !container) return;
                
                const moveInterval = setInterval(() => {
                    let newTop, newLeft;
                    do {
                        newTop = Math.random() * 80 + 10;
                        newLeft = Math.random() * 80 + 10;
                    } while (Math.abs(newTop - parseFloat(star.style.top)) < 20 || 
                             Math.abs(newLeft - parseFloat(star.style.left)) < 20);
                    
                    star.style.transition = 'all 2s ease-in-out';
                    star.style.top = newTop + '%';
                    star.style.left = newLeft + '%';
                }, 8000 + Math.random() * 5000);
            }
        };

        // ÂÖ®Â±ÄÂáΩÊï∞Ôºà‰æõHTMLË∞ÉÁî®Ôºâ
        function startGame() {
            gameCore.startGame();
        }

        function nextQuestion() {
            gameCore.nextQuestion();
        }

        function toggleAudio() {
            audioManager.toggle();
        }

        // ÂàùÂßãÂåñ - ‰ºòÂåñÁâàÊú¨
        async function init() {
            try {
                // È¢ÑÂä†ËΩΩÂÖ≥ÈîÆËµÑÊ∫ê
                await Promise.all([
                    utils.preloadImages(backgroundImages.slice(0, 3)),
                    utils.preloadImage('couple-photo.jpg').catch(() => null)
                ]);
                
                // ÂàùÂßãÂåñÂêÑ‰∏™Ê®°Âùó
                audioManager.init();
                progressIndicator.init();
                bubbleManager.start();
                
                gameState.isInitialized = true;
                gameState.resourcesLoaded = true;
                
                // ÈöêËóèÂä†ËΩΩÁïåÈù¢
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.classList.add('hide');
                    }
                }, 500);
                
                // Â∞ùËØïÂ§öÁßçÊñπÂºèËá™Âä®Êí≠ÊîæÈü≥È¢ë
                const startSection = document.getElementById('start-section');
                if (startSection && startSection.classList.contains('active')) {
                    await attemptAutoPlay();
                }
                
            } catch (error) {
                utils.handleError(error, 'Initialization');
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.classList.add('hide');
                }
            }
        }

        // Â∞ùËØïËá™Âä®Êí≠ÊîæÈü≥È¢ë
        async function attemptAutoPlay() {
            try {
                // ÊñπÊ≥ï1ÔºöÁõ¥Êé•Êí≠Êîæ
                await audioManager.play(startAudio);
            } catch (e) {
                console.log('ÊñπÊ≥ï1Â§±Ë¥•ÔºåÂ∞ùËØïÊñπÊ≥ï2');
                try {
                    // ÊñπÊ≥ï2ÔºöËÆæÁΩÆÈùôÈü≥Êí≠ÊîæÂêéÂèñÊ∂àÈùôÈü≥
                    startAudio.muted = true;
                    await startAudio.play();
                    startAudio.muted = false;
                    startAudio.volume = 0.7;
                } catch (e2) {
                    console.log('ÊñπÊ≥ï2Â§±Ë¥•ÔºåÂ∞ùËØïÊñπÊ≥ï3');
                    try {
                        // ÊñπÊ≥ï3ÔºöÁî®Êà∑‰∫§‰∫íÂêéÊí≠Êîæ
                        const playOnInteraction = () => {
                            audioManager.play(startAudio);
                            document.removeEventListener('click', playOnInteraction);
                            document.removeEventListener('touchstart', playOnInteraction);
                            document.removeEventListener('keydown', playOnInteraction);
                        };
                        document.addEventListener('click', playOnInteraction);
                        document.addEventListener('touchstart', playOnInteraction);
                        document.addEventListener('keydown', playOnInteraction);
                    } catch (e3) {
                        console.log('ÊâÄÊúâËá™Âä®Êí≠ÊîæÊñπÊ≥ïÈÉΩÂ§±Ë¥•');
                    }
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Ê∑ªÂä†Áî®Êà∑‰∫§‰∫íÊ£ÄÊµã
        let hasUserInteracted = false;
        const userInteractionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
        
        userInteractionEvents.forEach(event => {
            document.addEventListener(event, () => {
                if (!hasUserInteracted) {
                    hasUserInteracted = true;
                    // Áî®Êà∑È¶ñÊ¨°‰∫§‰∫íÊó∂Â∞ùËØïÊí≠ÊîæÈü≥È¢ë
                    if (gameState.audioEnabled && startAudio) {
                        audioManager.play(startAudio).catch(() => {
                            console.log('Áî®Êà∑‰∫§‰∫íÂêéÈü≥È¢ëÊí≠ÊîæÂ§±Ë¥•');
                        });
                    }
                }
            }, { once: true });
        });

        // È°µÈù¢ÂèØËßÅÊÄßÂèòÂåñÂ§ÑÁêÜ
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                [startAudio, gameAudio, endingAudio].forEach(audio => {
                    if (audio && !audio.paused) {
                        audio.pause();
                    }
                });
            } else if (gameState.audioEnabled) {
                audioManager.resumeCurrentAudio();
            }
        });

        // ÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('error', (e) => {
            utils.handleError(e.error, 'Global error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            utils.handleError(e.reason, 'Unhandled promise rejection');
        });

        // ÊÄßËÉΩÁõëÊéß
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
                }, 0);
            });
        }
    </script>
</body>
</html>