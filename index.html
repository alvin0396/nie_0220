<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åªç»™å°frennieçš„æ¸¸æˆâ˜†â˜†</title>
    <meta name="description" content="ä¸€ä¸ªç‰¹åˆ«ä¸ºå°frennieåˆ¶ä½œçš„çˆ±å¿ƒæ¸¸æˆ">
    <meta name="theme-color" content="#ff4d94">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* æ ¹å˜é‡å®šä¹‰ */
        :root {
            --primary-color: #ff4d94;
            --secondary-color: #ff6b9d;
            --accent-color: #ffd700;
            --text-light: #fff;
            --text-dark: #1a1a1a;
            --bg-gradient: linear-gradient(135deg, #ffb3d9, #ffe6f2);
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.3);
            --shadow-heavy: rgba(0, 0, 0, 0.7);
            --border-radius: 20px;
            --transition: all 0.3s ease;
            --blur-light: blur(1px);
            --blur-medium: blur(5px);
        }

        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            height: 100vh;
            background: #000;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* åŠ è½½åŠ¨ç”»ä¼˜åŒ– */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            will-change: opacity;
        }

        .loading.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-size: clamp(1.2em, 4vw, 1.5em);
            color: var(--primary-color);
            font-weight: bold;
            animation: pulse 1.5s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.6; 
                transform: scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
            }
        }

        /* é€šç”¨sectionæ ·å¼ */
        .section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            will-change: opacity;
        }

        .section.active {
            display: block;
            opacity: 1;
        }

        /* å¼€å§‹ç•Œé¢æ ·å¼ä¼˜åŒ– */
        #start-section {
            background: var(--bg-gradient);
            position: relative;
            overflow: hidden;
        }

        .wave-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 255, 255, 0.1) 35px, rgba(255, 255, 255, 0.1) 70px);
            animation: waveMove 8s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes waveMove {
            0%, 100% { 
                transform: translateX(0) translateY(0); 
            }
            50% { 
                transform: translateX(10px) translateY(-10px); 
            }
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.3));
            animation: bubbleFloat linear infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            will-change: transform, opacity;
        }

        @keyframes bubbleFloat {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        .start-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }

        .game-title {
            font-size: clamp(2em, 6vw, 3.5em);
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: titleGlow 3s ease-in-out infinite alternate;
            will-change: text-shadow;
        }

        @keyframes titleGlow {
            0% { 
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); 
            }
            100% { 
                text-shadow: 2px 2px 8px rgba(255, 77, 148, 0.3), 0 0 20px rgba(255, 182, 193, 0.5); 
            }
        }

        .star {
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
            animation: starTwinkle 2s ease-in-out infinite alternate;
        }

        @keyframes starTwinkle {
            0% { 
                text-shadow: 0 0 10px var(--accent-color); 
            }
            100% { 
                text-shadow: 0 0 20px var(--accent-color), 0 0 30px var(--accent-color); 
            }
        }

        .start-button {
            padding: 20px 40px;
            font-size: clamp(1.2em, 4vw, 1.5em);
            background: linear-gradient(45deg, var(--secondary-color), #ff8fb3);
            color: var(--text-light);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
            transition: var(--transition);
            font-family: inherit;
            position: relative;
            overflow: hidden;
            font-weight: bold;
        }

        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .start-button:hover::before {
            left: 100%;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.6);
        }

        .start-button:active {
            transform: translateY(-1px);
        }

        /* æ¸¸æˆéƒ¨åˆ†æ ·å¼ä¼˜åŒ– */
        #game-section {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            transition: background-image 0.5s ease-in-out;
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.05);
            backdrop-filter: var(--blur-light);
        }

        .game-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            text-align: center;
        }

        .instruction {
            font-size: clamp(1em, 3vw, 1.2em);
            color: var(--text-light);
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.1);
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 15px var(--shadow-light);
            text-shadow: 1px 1px 2px var(--shadow-heavy);
            backdrop-filter: var(--blur-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .question {
            font-size: clamp(1.2em, 4vw, 2em);
            font-weight: bold;
            color: var(--text-light);
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.1);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 30px var(--shadow-light);
            max-width: 90%;
            width: 100%;
            max-width: 800px;
            line-height: 1.4;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
            backdrop-filter: var(--blur-light);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: questionAppear 0.6s ease-out;
            will-change: transform, opacity;
        }

        @keyframes questionAppear {
            0% { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .answer-buttons {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .answer-btn {
            padding: 15px 30px;
            font-size: clamp(1.1em, 3vw, 1.3em);
            border: 3px solid rgba(52, 152, 219, 0.9);
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px var(--shadow-medium);
            backdrop-filter: var(--blur-medium);
            font-weight: bold;
            font-family: inherit;
            min-width: 120px;
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .answer-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .answer-btn:hover {
            background: rgba(52, 152, 219, 0.8);
            color: var(--text-light);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            border-color: rgba(52, 152, 219, 1);
        }

        .answer-btn:active {
            transform: translateY(0);
        }

        .answer-btn.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.7);
            cursor: not-allowed;
        }

        /* ç»“å°¾éƒ¨åˆ†æ ·å¼ä¼˜åŒ– */
        #ending-section {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3));
            position: relative;
            overflow: hidden;
            will-change: transform;
            min-height: 100vh;
        }

        .ending-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.9;
            z-index: 1;
            will-change: opacity;
            transition: opacity 0.5s ease-in-out;
            object-fit: contain;
        }

        .ending-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px 20px;
            will-change: transform;
        }

        .message-container {
            position: relative;
            width: min(90%, 800px);
            height: 80%;
            overflow: hidden;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: var(--blur-light);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            will-change: transform;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scrolling-text {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            color: var(--text-light);
            font-size: clamp(1.2em, 3.5vw, 1.6em);
            line-height: 2.5;
            text-align: center;
            text-shadow: 2px 2px 6px var(--shadow-heavy);
            animation: scrollUp 300s linear;
            white-space: pre-line;
            font-weight: 500;
            padding: 0 20px;
            transition: opacity 1s ease-out;
            will-change: transform;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            user-select: none;
            pointer-events: none;
        }

        @keyframes scrollUp {
            0% {
                transform: translateX(-50%) translateY(120%);
            }
            100% {
                transform: translateX(-50%) translateY(-120%);
            }
        }

        .final-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.5em, 5vw, 2.5em);
            font-weight: bold;
            color: var(--text-light);
            text-shadow: 3px 3px 8px var(--shadow-heavy);
            opacity: 0;
            text-align: center;
            z-index: 20;
            padding: 30px;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: var(--blur-medium);
            will-change: opacity, transform;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
            pointer-events: none;
        }

        .final-message.show {
            opacity: 1;
            animation: fadeIn 3s ease-in-out;
        }

        @keyframes fadeIn {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8) rotateY(-90deg); 
            }
            100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
            }
        }

        .celestial {
            position: absolute;
            color: var(--accent-color);
            font-size: clamp(1.5em, 4vw, 2em);
            animation: twinkle 3s ease-in-out infinite;
            filter: drop-shadow(0 0 15px var(--accent-color));
            text-shadow: 0 0 20px var(--accent-color);
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            pointer-events: none;
            user-select: none;
            z-index: 15;
        }

        @keyframes twinkle {
            0% { 
                opacity: 0.4; 
                transform: scale(0.8) rotate(0deg); 
                filter: drop-shadow(0 0 10px var(--accent-color));
            }
            50% { 
                opacity: 1; 
                transform: scale(1.3) rotate(180deg); 
                filter: drop-shadow(0 0 25px var(--accent-color));
            }
            100% { 
                opacity: 0.4; 
                transform: scale(0.8) rotate(360deg); 
                filter: drop-shadow(0 0 10px var(--accent-color));
            }
        }

        .moon {
            position: absolute;
            top: 10%;
            right: 10%;
            font-size: clamp(2em, 6vw, 4em);
            color: #f0f0f0;
            text-shadow: 0 0 20px #f0f0f0;
            animation: moonGlow 4s ease-in-out infinite alternate;
            will-change: text-shadow;
            pointer-events: none;
            user-select: none;
            z-index: 5;
        }

        @keyframes moonGlow {
            0% { text-shadow: 0 0 20px #f0f0f0; }
            100% { text-shadow: 0 0 40px #f0f0f0, 0 0 60px #f0f0f0; }
        }

        /* éŸ³é¢‘æ§åˆ¶ä¼˜åŒ– */
        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            font-size: 1.2em;
            transition: var(--transition);
            backdrop-filter: var(--blur-medium);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .audio-control:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ä¼˜åŒ– */
        .progress-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .progress-dot.active {
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            transform: scale(1.2);
        }

        /* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .answer-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .answer-btn {
                width: 200px;
            }
            
            .message-container {
                width: 95%;
            }
            
            .moon {
                top: 5%;
                right: 5%;
            }
        }

        @media (max-width: 480px) {
            .start-content {
                padding: 20px;
            }
            
            .game-content {
                padding: 15px;
            }
            
            .question {
                padding: 20px;
            }
        }

        /* æ€§èƒ½ä¼˜åŒ– */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            .section:not(.active) {
                display: none !important;
            }
        }

        /* ç„¦ç‚¹æ ·å¼ä¼˜åŒ– */
        .start-button:focus,
        .answer-btn:focus,
        .audio-control:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* åŠ è½½ä¼˜åŒ– */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .message-container {
                width: 95%;
                height: 85%;
            }
            
            .scrolling-text {
                font-size: clamp(1em, 3vw, 1.4em);
                line-height: 2.2;
            }
            
            .final-message {
                font-size: clamp(1.3em, 4vw, 2.2em);
                padding: 25px;
            }
            
            .moon {
                top: 5%;
                right: 5%;
                font-size: clamp(1.5em, 5vw, 3em);
            }
        }

        @media (max-width: 480px) {
            .ending-content {
                padding: 20px 15px;
            }
            
            .message-container {
                width: 98%;
                height: 90%;
            }
            
            .scrolling-text {
                font-size: clamp(0.9em, 2.8vw, 1.3em);
                line-height: 2.0;
                padding: 0 15px;
            }
            
            .final-message {
                font-size: clamp(1.2em, 3.5vw, 2em);
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div class="loading" id="loading">
        <div class="loading-text">æ­£åœ¨ä¸ºå°frennieå‡†å¤‡æ¸¸æˆ...</div>
    </div>

    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="start-section" class="section active">
        <div class="wave-pattern"></div>
        <div class="start-content">
            <h1 class="game-title">åªç»™å°frennieçš„æ¸¸æˆ<span class="star">â˜†â˜†</span></h1>
            <button class="start-button" onclick="startGame()" aria-label="å¼€å§‹æ¸¸æˆ">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- æ¸¸æˆéƒ¨åˆ† -->
    <div id="game-section" class="section">
        <div class="game-overlay"></div>
        <div class="game-content">
            <div class="instruction" id="instruction">æ˜¯çš„è¯é€‰æ‹©"å—¯"ï¼Œä¸æ˜¯çš„è¯å°±å¡«"ä¸æ˜¯"</div>
            <div class="question" id="question-text" role="main"></div>
            <div class="answer-buttons">
                <button class="answer-btn" onclick="nextQuestion()" aria-label="æ˜¯çš„">å—¯</button>
                <button class="answer-btn" onclick="nextQuestion()" aria-label="ä¸æ˜¯çš„">ä¸æ˜¯</button>
            </div>
        </div>
    </div>

    <!-- ç»“å°¾éƒ¨åˆ† -->
    <div id="ending-section" class="section">
        <div class="ending-background" id="ending-background"></div>
        <div class="ending-content">
            <div class="message-container">
                <div class="scrolling-text" id="scrolling-text"></div>
            </div>
            <div class="final-message" id="final-message">æˆ‘çˆ±ä½ ï¼Œæˆ‘çš„å°Frennieï¼Œç¥ä½ å¹¸ç¦</div>
            <div class="moon">ğŸŒ™</div>
        </div>
    </div>

    <!-- éŸ³é¢‘æ§åˆ¶ -->
    <div class="audio-control" id="audio-control" onclick="toggleAudio()" title="éŸ³é¢‘æ§åˆ¶">
        <span id="audio-icon">ğŸ”Š</span>
    </div>

    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="progress-indicator" id="progress-indicator"></div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="start-audio" loop preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="start-music.mp3" type="audio/mpeg">
        <source src="start-music.ogg" type="audio/ogg">
    </audio>
    <audio id="game-audio" loop preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="game-music.mp3" type="audio/mpeg">
        <source src="game-music.ogg" type="audio/ogg">
    </audio>
    <audio id="ending-audio" preload="auto" playsinline webkit-playsinline x5-playsinline>
        <source src="ending-music.mp3" type="audio/mpeg">
        <source src="ending-music.ogg" type="audio/ogg">
    </audio>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç† - ä¼˜åŒ–ç‰ˆæœ¬
        class GameState {
            constructor() {
                this.currentQuestion = 0;
                this.audioEnabled = true;
                this.isTransitioning = false;
                this.preloadedImages = new Map();
                this.isInitialized = false;
                this.resourcesLoaded = false;
            }

            reset() {
                this.currentQuestion = 0;
                this.isTransitioning = false;
            }
        }

        const gameState = new GameState();

        // é—®é¢˜æ•°ç»„ - ä¼˜åŒ–ç»“æ„
        const questions = [
            "ä½ å¿ƒé‡Œè¿˜æœ‰ä»–å—ï¼Ÿ",
            "ä¸ºä»€ä¹ˆä½ æ˜¯å¦çœ‹åˆ°ä»–çš„æ—¶å€™ä¼šæ„Ÿåˆ°ä¼¤å¿ƒå’Œéš¾è¿‡ï¼Ÿ",
            "ä½ æ˜¯ä¸æ˜¯å®³æ€•ä»–åœ¨åšä»»ä½•ä¼¤å®³è‡ªå·±çš„äº‹æƒ…ï¼Ÿ",
            "ä½ æ˜¯ä¸æ˜¯å¾ˆè‡ªè´£ç¦»å¼€äº†ä»–è®©ä»–ç—›è‹¦äº†ï¼Ÿ",
            "ä½ ä¼šä¸ä¼šå®³æ€•åœ¨çœ‹åˆ°ä»–çš„æ—¶å€™ä¼šæƒ³èµ·ä½ ä»¬çš„å›å¿†ç„¶åå¾ˆéš¾é¢å¯¹ä»–ï¼Ÿ",
            "ä¸ºä»€ä¹ˆæ¯æ¬¡ä»–é—®ä½ äº‹æƒ…çš„æ—¶å€™ï¼Œä½ éƒ½ä¼šå¾ˆæ’æ–¥ä»–ï¼Œæ˜¯å› ä¸ºä»–ä¼¤å®³äº†ä½ å—ï¼Ÿè®©ä½ ä¼¤å¿ƒéš¾è¿‡å§”å±ˆäº†å—ï¼Ÿä½ æ¥å—ä¸äº†å—ï¼Ÿè¿˜æ˜¯è¯´ä»–å¼ºè¿«äº†ä½ ï¼Œç»™äºˆäº†ä½ å¾ˆå¤§çš„å‹åŠ›å‘¢ï¼Ÿ",
            "ä½ æœ‰æ²¡æœ‰åŸè°…ä»–ç»™ä½ å¸¦æ¥çš„ä¼¤å®³ï¼Œæœ‰æ²¡æœ‰ç†è§£ä»–æ²¡æœ‰åšåˆ°çš„ç†ç”±ï¼Ÿ",
            "å‡å¦‚è¯´ä½ èƒ½å¤Ÿç†è§£çš„è¯ä»–ä¹Ÿå¥½èµ·æ¥äº†ï¼Œä½ è¿˜æ„¿ä¸æ„¿æ„è·Ÿä»–å†é‡æ–°æ¥è¿‡ä¸€æ¬¡ï¼Ÿ",
            "å¦‚æœè¿™æ ·åšä½ ä¼šä¸ä¼šæ„Ÿè§‰åˆ°å¾ˆç—›è‹¦ï¼Ÿ",
            "ä»–æ‰€åšçš„åŠªåŠ›ï¼Œå…¶å®ä½ æœ‰æ²¡æœ‰çœ‹åœ¨çœ¼é‡Œï¼Œæœ‰æ²¡æœ‰æ„ŸåŠ¨åˆ°ï¼Ÿ",
            "ä½ æœ‰æ²¡æœ‰è§‰å¾—ä½ æ˜¯ä¸ªå°å‚»ç“œï¼Œå› ä¸ºä»–æ˜æ˜é‚£ä¹ˆçš„çˆ±ä½ ï¼Œä½†æ˜¯ä½ æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œç„¶åè¦ç¦»å¼€ä»–äº†ï¼Œæ”¾å¼ƒäº†ä¸€ä¸ªä½ å–œæ¬¢ä»–ï¼Œä»–ä¹Ÿå–œæ¬¢ä½ çš„äººï¼Ÿ",
            "ä½ ä¼šæ”¾ä¸‹è¿™æ®µæ„Ÿæƒ…å—ï¼Œå“ªæ€•é”™è¿‡äº†å°±å†ä¹Ÿæ²¡æœºä¼šé‡åˆ°äº†ï¼Œè¿™æ ·çš„æ”¾ä¸‹ä¼šè®©ä½ é—æ†¾ä¸€è¾ˆå­å—ï¼Ÿ"
        ];

        // èƒŒæ™¯å›¾ç‰‡æ•°ç»„
        const backgroundImages = [
            'your-photo1.jpg',
            'your-photo2.jpg',
            'your-photo3.jpg',
            'your-photo4.jpg',
            'your-photo5.jpg',
            'your-photo6.jpg',
            'your-photo7.jpg',
            'your-photo8.jpg',
            'your-photo9.jpg',
            'your-photo10.jpg',
            'your-photo11.jpg',
            'your-photo12.jpg'
        ];

        // éŸ³é¢‘å¼•ç”¨
        let startAudio, gameAudio, endingAudio;

        // å·¥å…·å‡½æ•° - ä¼˜åŒ–ç‰ˆæœ¬
        const utils = {
            // é˜²æŠ–å‡½æ•°ä¼˜åŒ–
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // èŠ‚æµå‡½æ•°
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },

            // é¢„åŠ è½½å›¾ç‰‡ä¼˜åŒ–
            preloadImage(src) {
                return new Promise((resolve, reject) => {
                    if (gameState.preloadedImages.has(src)) {
                        resolve(gameState.preloadedImages.get(src));
                        return;
                    }
                    
                    const img = new Image();
                    img.onload = () => {
                        gameState.preloadedImages.set(src, img);
                        resolve(img);
                    };
                    img.onerror = reject;
                    img.src = src;
                });
            },

            // æ‰¹é‡é¢„åŠ è½½å›¾ç‰‡ä¼˜åŒ–
            async preloadImages(srcs) {
                const promises = srcs.map(src => this.preloadImage(src).catch(() => null));
                return Promise.allSettled(promises);
            },

            // å¹³æ»‘åˆ‡æ¢sectionä¼˜åŒ–
            switchSection(fromId, toId) {
                if (gameState.isTransitioning) return;
                gameState.isTransitioning = true;

                const fromSection = document.getElementById(fromId);
                const toSection = document.getElementById(toId);

                if (!fromSection || !toSection) {
                    console.error('Section not found');
                    gameState.isTransitioning = false;
                    return;
                }

                // æ·¡å‡ºå½“å‰section
                fromSection.style.opacity = '0';
                
                setTimeout(() => {
                    fromSection.classList.remove('active');
                    toSection.classList.add('active');
                    
                    // æ·¡å…¥æ–°section
                    requestAnimationFrame(() => {
                        toSection.style.opacity = '1';
                        gameState.isTransitioning = false;
                    });
                }, 300);
            },

            // é”™è¯¯å¤„ç†
            handleError(error, context) {
                console.error(`Error in ${context}:`, error);
                // å¯ä»¥æ·»åŠ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
            }
        };

        // éŸ³é¢‘ç®¡ç† - ä¼˜åŒ–ç‰ˆæœ¬
        const audioManager = {
            init() {
                startAudio = document.getElementById('start-audio');
                gameAudio = document.getElementById('game-audio');
                endingAudio = document.getElementById('ending-audio');

                // é¢„åŠ è½½éŸ³é¢‘å¹¶è®¾ç½®ç§»åŠ¨ç«¯ä¼˜åŒ–
                [startAudio, gameAudio, endingAudio].forEach(audio => {
                    if (audio) {
                        // ç§»åŠ¨ç«¯ä¼˜åŒ–è®¾ç½®
                        audio.preload = 'auto';
                        audio.load();
                        audio.volume = 0.7;
                        
                        // è®¾ç½®ç§»åŠ¨ç«¯å…¼å®¹æ€§
                        audio.setAttribute('playsinline', '');
                        audio.setAttribute('webkit-playsinline', '');
                        audio.setAttribute('x5-playsinline', '');
                        
                        // é”™è¯¯å¤„ç†
                        audio.addEventListener('error', (e) => {
                            utils.handleError(e, 'Audio loading');
                        });
                        
                        // ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
                        audio.addEventListener('canplay', () => {
                            console.log('éŸ³é¢‘å¯ä»¥æ’­æ”¾');
                        });
                        
                        audio.addEventListener('canplaythrough', () => {
                            console.log('éŸ³é¢‘å®Œå…¨åŠ è½½');
                        });
                    }
                });
            },

            async play(audio) {
                if (!gameState.audioEnabled || !audio) return;
                
                try {
                    // ç¡®ä¿éŸ³é¢‘å·²åŠ è½½
                    if (audio.readyState < 2) {
                        await new Promise((resolve) => {
                            audio.addEventListener('canplaythrough', resolve, { once: true });
                            audio.load();
                        });
                    }
                    
                    // ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
                    audio.currentTime = 0;
                    
                    // å°è¯•å¤šç§æ’­æ”¾æ–¹å¼
                    try {
                        await audio.play();
                    } catch (e) {
                        // å¦‚æœç›´æ¥æ’­æ”¾å¤±è´¥ï¼Œå°è¯•é™éŸ³æ’­æ”¾åå–æ¶ˆé™éŸ³
                        audio.muted = true;
                        await audio.play();
                        audio.muted = false;
                        audio.volume = 0.7;
                    }
                } catch (e) {
                    utils.handleError(e, 'Audio playback');
                    console.warn('éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                }
            },

            stop(audio) {
                if (!audio) return;
                audio.pause();
                audio.currentTime = 0;
            },

            toggle() {
                gameState.audioEnabled = !gameState.audioEnabled;
                const icon = document.getElementById('audio-icon');
                
                if (gameState.audioEnabled) {
                    icon.textContent = 'ğŸ”Š';
                    this.resumeCurrentAudio();
                } else {
                    icon.textContent = 'ğŸ”‡';
                    [startAudio, gameAudio, endingAudio].forEach(audio => {
                        if (audio) audio.pause();
                    });
                }
            },

            resumeCurrentAudio() {
                const startSection = document.getElementById('start-section');
                const gameSection = document.getElementById('game-section');
                const endingSection = document.getElementById('ending-section');

                if (startSection.classList.contains('active')) {
                    this.play(startAudio);
                } else if (gameSection.classList.contains('active')) {
                    this.play(gameAudio);
                } else if (endingSection.classList.contains('active')) {
                    this.play(endingAudio);
                }
            }
        };

        // è¿›åº¦æŒ‡ç¤ºå™¨ - ä¼˜åŒ–ç‰ˆæœ¬
        const progressIndicator = {
            init() {
                const container = document.getElementById('progress-indicator');
                if (!container) return;
                
                container.innerHTML = '';
                
                // åˆ›å»ºè¿›åº¦ç‚¹ï¼šå¼€å§‹ + 12ä¸ªé—®é¢˜ + ç»“å°¾ = 14ä¸ªç‚¹
                for (let i = 0; i < 14; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'progress-dot';
                    if (i === 0) dot.classList.add('active');
                    container.appendChild(dot);
                }
            },

            update(step) {
                const dots = document.querySelectorAll('.progress-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index <= step);
                });
            }
        };

        // æ³¡æ³¡æ•ˆæœç®¡ç† - ä¼˜åŒ–ç‰ˆæœ¬
        const bubbleManager = {
            intervalId: null,
            
            start() {
                const container = document.getElementById('start-section');
                if (!container) return;
                
                this.intervalId = setInterval(() => {
                    if (!document.getElementById('start-section').classList.contains('active')) {
                        return;
                    }
                    
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = Math.random() * 100 + '%';
                    bubble.style.width = bubble.style.height = (Math.random() * 60 + 20) + 'px';
                    bubble.style.animationDuration = (Math.random() * 3 + 4) + 's';
                    container.appendChild(bubble);

                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 7000);
                }, 500);
            },

            stop() {
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
            }
        };

        // æ¸¸æˆæ ¸å¿ƒåŠŸèƒ½ - ä¼˜åŒ–ç‰ˆæœ¬
        const gameCore = {
            async startGame() {
                if (gameState.isTransitioning) return;
                
                bubbleManager.stop();
                audioManager.stop(startAudio);
                
                utils.switchSection('start-section', 'game-section');
                
                await audioManager.play(gameAudio);
                this.showQuestion();
                progressIndicator.update(1);
            },

            async showQuestion() {
                if (gameState.currentQuestion >= questions.length) {
                    this.showEnding();
                    return;
                }

                const questionElement = document.getElementById('question-text');
                const instructionElement = document.getElementById('instruction');
                const gameSection = document.getElementById('game-section');
                const answerBtns = document.querySelectorAll('.answer-btn');
                
                if (!questionElement || !instructionElement || !gameSection) {
                    utils.handleError('Question elements not found', 'showQuestion');
                    return;
                }
                
                // ç¦ç”¨é€‰æ‹©æŒ‰é’®ï¼ˆç”¨requestAnimationFrameä¿è¯UIåˆ·æ–°æµç•…ï¼‰
                requestAnimationFrame(() => {
                    answerBtns.forEach(btn => {
                        btn.disabled = true;
                        btn.classList.add('disabled');
                    });
                });
                
                // åªåœ¨ç¬¬ä¸€é¢˜æ˜¾ç¤ºè¯´æ˜
                if (gameState.currentQuestion === 0) {
                    instructionElement.style.display = 'block';
                } else {
                    instructionElement.style.display = 'none';
                }

                // ç«‹å³åˆ‡æ¢é¢˜ç›®å’ŒèƒŒæ™¯ï¼ˆåŠ æ¨¡ç³Šæ»¤é•œï¼Œä¿è¯åŒæ­¥ï¼‰
                const imageSrc = backgroundImages[gameState.currentQuestion];
                gameSection.style.backgroundImage = `url("${imageSrc}")`;
                gameSection.style.backgroundColor = '';
                gameSection.style.filter = 'blur(10px)';
                
                // ç«‹å³åˆ‡æ¢é¢˜ç›®å†…å®¹å’ŒæŒ‰é’®
                questionElement.style.opacity = '0';
                setTimeout(() => {
                    questionElement.textContent = questions[gameState.currentQuestion];
                    questionElement.style.opacity = '1';
                    progressIndicator.update(gameState.currentQuestion + 2);
                }, 30);

                // å¼‚æ­¥åŠ è½½å›¾ç‰‡ï¼ŒåŠ è½½å®Œæˆåå¹³æ»‘å»æ‰æ»¤é•œå¹¶å¯ç”¨æŒ‰é’®
                utils.preloadImage(imageSrc).then(() => {
                    gameSection.style.transition = 'filter 0.4s cubic-bezier(.4,2,.6,1)';
                    gameSection.style.filter = '';
                    setTimeout(() => {
                        gameSection.style.transition = '';
                    }, 400);
                    requestAnimationFrame(() => {
                        answerBtns.forEach(btn => {
                            btn.disabled = false;
                            btn.classList.remove('disabled');
                        });
                    });
                }).catch(e => {
                    // å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œç»§ç»­ç”¨æ¨¡ç³Šå›¾ï¼Œä¸å¯ç”¨æŒ‰é’®
                    utils.handleError(e, 'Background image loading');
                });
            },

            // nextQuestioné‡‡ç”¨èŠ‚æµï¼Œé˜²æ­¢è¯¯è§¦ä½†ä¿è¯å“åº”
            nextQuestion: utils.throttle(function() {
                const questionElement = document.getElementById('question-text');
                if (!questionElement || questionElement.style.opacity === '0' || !questionElement.textContent) {
                    return;
                }
                gameState.currentQuestion++;
                if (gameState.currentQuestion < questions.length) {
                    gameCore.showQuestion();
                } else {
                    gameCore.showEnding();
                }
            }, 400),

            async showEnding() {
                try {
                    // åœæ­¢æ¸¸æˆéŸ³é¢‘
                    audioManager.stop(gameAudio);
                    
                    // é¢„åŠ è½½å¹¶è®¾ç½®æƒ…ä¾£ç…§ç‰‡èƒŒæ™¯
                    const endingBg = document.getElementById('ending-background');
                    if (endingBg) {
                        try {
                            await utils.preloadImage('couple-photo.jpg');
                            endingBg.style.backgroundImage = 'url("couple-photo.jpg")';
                        } catch (e) {
                            utils.handleError(e, 'Couple photo loading');
                        }
                    }
                    
                    // åˆ‡æ¢åˆ°ç»“å°¾éƒ¨åˆ†
                    utils.switchSection('game-section', 'ending-section');
                    
                    // æ’­æ”¾ç»“å°¾éŸ³ä¹å¹¶ç«‹å³å¼€å§‹å­—å¹•
                    await audioManager.play(endingAudio);
                    this.startScrollingText();
                    
                    // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
                    progressIndicator.update(13);
                } catch (error) {
                    utils.handleError(error, 'showEnding');
                }
            },

            startScrollingText() {
                // å­—å¹•å†…å®¹
                const message = `å…¶å®ç­”æ¡ˆå¹¶ä¸é‡è¦ï¼Œå°å‚»ç“œ
åˆ«å†é’»ç‰›è§’å°–å•¦
ä¹Ÿåˆ«å†æƒ³åˆ°æˆ‘å°±ç—›è‹¦äº†å™¢

æˆ‘ä»¬æ˜æ˜è¿‡å¾—é‚£ä¹ˆå¼€å¿ƒ
ä½ æƒ³æƒ³å‘€å»å¹´æˆ‘é‚£ä¹ˆåœ°ç…§é¡¾ä½ 
é‚£ä¹ˆåœ°åœ¨ä¹ä½ æ‰€è¯´çš„äº‹æƒ…

å“ªæœ‰ä¸€ä¸ªä¸çˆ±ä½ çš„ç”·ç”Ÿ
ä¼šæ—¶æ—¶åˆ»åˆ»è®°å¾—
æ‰€æœ‰ä½ çš„äº‹æƒ…å‘¢

æˆ‘çŸ¥é“å…¶å®æœ‰çš„æ—¶å€™
ä½ å†…å¿ƒæ˜¯åœ¨å´©å¡Œè¾¹ç¼˜çš„
æ€»æ˜¯ä¸€ä¸ªäººé»˜é»˜æ‰¿å—

è™½ç„¶è¡¨é¢ä¸Šè£…å¾—å¾ˆåšå¼º
ä¸è¿‡éƒ½æ˜¯ä¸ºäº†è®©æˆ‘ä»¬è§‰å¾—
ä¸è¦æ‹…å¿ƒä½ ï¼Œè§‰å¾—ä½ æ²¡æœ‰äº‹æƒ…

æ‰€ä»¥æˆ‘æ‰ä¼šæ²¡å‘ç°åˆ°
ä½ æ€»æ˜¯ä¸€ä¸ªäººå“­æ³£
æ˜¯æˆ‘ä¸ç»†å¿ƒäº†ï¼

ä½ åªä¸è¿‡æ˜¯ä¸ªå¾ˆè¦å¼ºçš„å°å¥³ç”Ÿ
å…¶å®å†…å¿ƒå¾ˆè„†å¼±ä¹Ÿå¾ˆèƒ†å°
æœ‰æ—¶å€™æ€»è§‰å¾—è‡ªå·±å¾ˆæ— åŠ©

å¯¹å¾ˆå¤šäº‹æƒ…éƒ½æ— èƒ½ä¸ºåŠ›
å³ä¾¿ä½ ä»€ä¹ˆéƒ½æ²¡è¯´
å´åˆå¸Œæœ›æœ‰äººçŸ¥é“ä½ å†…å¿ƒçš„ç»æœ›æ„Ÿ

é‚£ä¸ªäº†è§£ä½ çš„äººä¼šæ‹‰ä½ ä¸€æŠŠ
å“ªæ€•åªæ˜¯ä¸€æ¬¡
ä¹Ÿèƒ½æ‹¯æ•‘ä½ çš„å¿ƒ

æˆ‘æƒ³ä½ ä¼šå–œæ¬¢ä¸Šæˆ‘
è‚¯å®šæ˜¯å› ä¸ºä½ æ²¡æƒ³è¿‡
ä¼šæœ‰äººç”¨æ¸©æŸ”æ¥ä½äº†ä½ å¿«å´©å¡Œçš„ä¸–ç•Œ

ä½ ä¹Ÿè¯´è¿‡æˆ‘å°±å¥½åƒæ˜Ÿè¾°
æˆ‘å¾ˆè£å¹¸ä½ èƒ½é‚£ä¹ˆä¿¡ä»»æˆ‘
æ‰€ä»¥æˆ‘æ‰ä¼šåœ¨ä½ æœ‰å›°éš¾çš„æ—¶å€™

æ— æ¡ä»¶çš„ç»™ä½ ä¸€ç›ç¯
ä¹Ÿåƒæ˜Ÿè¾°ä¸€æ ·
æŒ‡å¼•ç€ä½ 

æˆ‘å‘€ï¼Œæ—©åœ¨æˆ‘ä»¬ä½åœ¨ä¸€èµ·çš„æ—¶å€™
å°±åŠªåŠ›çš„è€å¿ƒçš„å®ˆå€™ç€
é‚£ä¸ªéå¸¸ä¸å®Œç¾çš„ä½ 

å› ä¸ºé‚£ä¸ªäººæ˜¯ä½ 
æ‰€ä»¥ä½ çš„æ€§æ ¼
ä½ çš„æ¯ä¸ªä¹ æƒ¯æˆ‘éƒ½ä¼šå¾ˆå–œæ¬¢ç€

å…¶å®åˆé€‚çš„äºº
éƒ½ä¼šç»å†ç™¾æ¬¡çš„ä¸åˆé€‚
æ²¡æœ‰å¤©ç”Ÿå°±åˆé€‚çš„ä¸¤ä¸ªäºº

åªæœ‰ä¸¤ä¸ªæ„¿æ„ç£¨åˆçš„å¿ƒ
å¯¹æˆ‘æ¥è¯´
æˆ‘çˆ±ä¸Šä½ æ²¡ä»€ä¹ˆäº†ä¸èµ·

ä½†æˆ‘ä¼šçˆ±ä¸‹å»
æ‰äº†ä¸èµ·

å¦‚ä»Šçš„æˆ‘ä¸å†é»‘æš—é‡Œæ²‰æ²¦
ä¹Ÿæ‰¾åˆ°è‡ªå·±çš„ç›®æ ‡äº†
ç°åœ¨çš„ä½ 

å¦‚æœæ‰¾åˆ°äº†ä½ æƒ³è¦çš„äººå’Œæ–¹å‘
å°±å¾€é‚£ä¸ªæ–¹å‘å¥”è·‘å§
æˆ‘ç¥ç¦ä½ 

æ„¿ä½ è¿™ä¸€ç”Ÿ
éƒ½èƒ½å¿«å¿«ä¹ä¹`;

                const scrollingText = document.getElementById('scrolling-text');
                if (!scrollingText) {
                    utils.handleError('Scrolling text element not found', 'startScrollingText');
                    return;
                }

                // è®¾ç½®æ–‡å­—å†…å®¹å¹¶ç«‹å³å¼€å§‹æ»šåŠ¨
                scrollingText.textContent = message;
                
                // 180ç§’åæ˜¾ç¤ºæœ€ç»ˆæ¶ˆæ¯å’Œæ˜Ÿæ˜Ÿç‰¹æ•ˆ
                setTimeout(() => {
                    this.showFinalMessage();
                }, 180000);
            },

            showFinalMessage() {
                try {
                    const finalMessage = document.getElementById('final-message');
                    if (finalMessage) {
                        finalMessage.classList.add('show');
                    }
                    this.createStars();
                } catch (error) {
                    utils.handleError(error, 'showFinalMessage');
                }
            },

            createStars() {
                const container = document.getElementById('ending-section');
                if (!container) {
                    utils.handleError('Ending section not found', 'createStars');
                    return;
                }
                
                const starCount = 12;
                const stars = [];
                
                // åˆ›å»ºæ˜Ÿæ˜Ÿ
                for (let i = 0; i < starCount; i++) {
                    setTimeout(() => {
                        const star = document.createElement('div');
                        star.className = 'celestial';
                        star.innerHTML = 'â­';
                        
                        // éšæœºä½ç½®ï¼Œé¿å…é‡å 
                        let top, left;
                        do {
                            top = Math.random() * 80 + 10;
                            left = Math.random() * 80 + 10;
                        } while (this.isPositionTooClose(top, left, stars));
                        
                        star.style.top = top + '%';
                        star.style.left = left + '%';
                        star.style.animationDelay = Math.random() * 3 + 's';
                        star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                        
                        container.appendChild(star);
                        stars.push(star);
                        
                        // 5ç§’åç§»åŠ¨åˆ°æ–°ä½ç½®
                        setTimeout(() => {
                            this.moveStarToNewPosition(star, container);
                        }, 5000 + Math.random() * 3000);
                    }, i * 300);
                }
            },
            
            isPositionTooClose(top, left, existingStars) {
                for (let star of existingStars) {
                    const starTop = parseFloat(star.style.top);
                    const starLeft = parseFloat(star.style.left);
                    const distance = Math.sqrt(Math.pow(top - starTop, 2) + Math.pow(left - starLeft, 2));
                    if (distance < 15) return true;
                }
                return false;
            },
            
            moveStarToNewPosition(star, container) {
                if (!star || !container) return;
                
                const moveInterval = setInterval(() => {
                    let newTop, newLeft;
                    do {
                        newTop = Math.random() * 80 + 10;
                        newLeft = Math.random() * 80 + 10;
                    } while (Math.abs(newTop - parseFloat(star.style.top)) < 20 || 
                             Math.abs(newLeft - parseFloat(star.style.left)) < 20);
                    
                    star.style.transition = 'all 2s ease-in-out';
                    star.style.top = newTop + '%';
                    star.style.left = newLeft + '%';
                }, 8000 + Math.random() * 5000);
            }
        };

        // å…¨å±€å‡½æ•°ï¼ˆä¾›HTMLè°ƒç”¨ï¼‰
        function startGame() {
            gameCore.startGame();
        }

        function nextQuestion() {
            gameCore.nextQuestion();
        }

        function toggleAudio() {
            audioManager.toggle();
        }

        // åˆå§‹åŒ– - ä¼˜åŒ–ç‰ˆæœ¬
        async function init() {
            try {
                // é¢„åŠ è½½å…³é”®èµ„æº
                await Promise.all([
                    utils.preloadImages(backgroundImages.slice(0, 3)),
                    utils.preloadImage('couple-photo.jpg').catch(() => null)
                ]);
                
                // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
                audioManager.init();
                progressIndicator.init();
                bubbleManager.start();
                
                gameState.isInitialized = true;
                gameState.resourcesLoaded = true;
                
                // éšè—åŠ è½½ç•Œé¢
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.classList.add('hide');
                    }
                }, 500);
                
                // å°è¯•å¤šç§æ–¹å¼è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘
                const startSection = document.getElementById('start-section');
                if (startSection && startSection.classList.contains('active')) {
                    await attemptAutoPlay();
                }
                
            } catch (error) {
                utils.handleError(error, 'Initialization');
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.classList.add('hide');
                }
            }
        }

        // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘
        async function attemptAutoPlay() {
            try {
                // æ–¹æ³•1ï¼šç›´æ¥æ’­æ”¾
                await audioManager.play(startAudio);
            } catch (e) {
                console.log('æ–¹æ³•1å¤±è´¥ï¼Œå°è¯•æ–¹æ³•2');
                try {
                    // æ–¹æ³•2ï¼šè®¾ç½®é™éŸ³æ’­æ”¾åå–æ¶ˆé™éŸ³
                    startAudio.muted = true;
                    await startAudio.play();
                    startAudio.muted = false;
                    startAudio.volume = 0.7;
                } catch (e2) {
                    console.log('æ–¹æ³•2å¤±è´¥ï¼Œå°è¯•æ–¹æ³•3');
                    try {
                        // æ–¹æ³•3ï¼šç”¨æˆ·äº¤äº’åæ’­æ”¾
                        const playOnInteraction = () => {
                            audioManager.play(startAudio);
                            document.removeEventListener('click', playOnInteraction);
                            document.removeEventListener('touchstart', playOnInteraction);
                            document.removeEventListener('keydown', playOnInteraction);
                        };
                        document.addEventListener('click', playOnInteraction);
                        document.addEventListener('touchstart', playOnInteraction);
                        document.addEventListener('keydown', playOnInteraction);
                    } catch (e3) {
                        console.log('æ‰€æœ‰è‡ªåŠ¨æ’­æ”¾æ–¹æ³•éƒ½å¤±è´¥');
                    }
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // æ·»åŠ ç”¨æˆ·äº¤äº’æ£€æµ‹
        let hasUserInteracted = false;
        const userInteractionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
        
        userInteractionEvents.forEach(event => {
            document.addEventListener(event, () => {
                if (!hasUserInteracted) {
                    hasUserInteracted = true;
                    // ç”¨æˆ·é¦–æ¬¡äº¤äº’æ—¶å°è¯•æ’­æ”¾éŸ³é¢‘
                    if (gameState.audioEnabled && startAudio) {
                        audioManager.play(startAudio).catch(() => {
                            console.log('ç”¨æˆ·äº¤äº’åéŸ³é¢‘æ’­æ”¾å¤±è´¥');
                        });
                    }
                }
            }, { once: true });
        });

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                [startAudio, gameAudio, endingAudio].forEach(audio => {
                    if (audio && !audio.paused) {
                        audio.pause();
                    }
                });
            } else if (gameState.audioEnabled) {
                audioManager.resumeCurrentAudio();
            }
        });

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (e) => {
            utils.handleError(e.error, 'Global error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            utils.handleError(e.reason, 'Unhandled promise rejection');
        });

        // æ€§èƒ½ç›‘æ§
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
                }, 0);
            });
        }
    </script>
</body>
</html>